{{ block "root" . }}

<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="color-scheme" content="light dark">

	<!-- Pico css -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2.0.6/css/pico.min.css" />

	<!-- htmx -->
	<script src="https://unpkg.com/htmx.org@2.0.4"
		integrity="sha384-HGfztofotfshcF7+8n44JQL2oJmowVChPTg48S+jvZoztPfvwD79OC/LTtG6dMp+"
		crossorigin="anonymous"></script>
	<script src="https://unpkg.com/htmx.org/dist/ext/preload.js"></script>

	<!-- Local imports -->
	<link rel="stylesheet" href="/public/styles/index.css" />
	<script src="/public/js/theme_switcher.js" defer></script>
	<script src="/public/js/search_box_dropdown.js" defer></script>
	<script src="/public/js/share_table.js" defer></script>

	<title>Share data tracker</title>
</head>

<body>

	<!-- Header -->
	<header class="container">
		<nav>
			<ul>
				<li><strong>Share data tracker</strong></li>
			</ul>
			<ul>
				<li>
					<details class="dropdown">
						<summary role="button" class="secondary">Theme</summary>
						<ul>
							<li><a href="#" data-theme-switcher="auto">Auto</a></li>
							<li><a href="#" data-theme-switcher="light">Light</a></li>
							<li><a href="#" data-theme-switcher="dark">Dark</a></li>
						</ul>
					</details>
				</li>
				<!-- <li><a href="#">About</a></li> -->
				<!-- <li><a href="#">Services</a></li> -->
				<!-- <li><a href="#">Products</a></li> -->
			</ul>
		</nav>
	</header>
	<!-- ./ Header -->

	<main class="container">

		<!-- TODO: Add htmx indicators -->
		<div class="center-child">
			<form role="search" id="ticker-search-box-form" hx-post="/sharedata" hx-target="#share-table-body"
				hx-swap="beforeend" hx-indicator="#search-progress">

				<div class="dropdown-container">
					<!-- Input field -->
					<input name="ticker" type="search" id="ticker-search-box" placeholder="VAS, VGS, DHHF..."
						autocomplete="off" hx-post="/searchtickers" hx-target="#ticker-search-dropdown-list"
						hx-swap="innerHTML" hx-trigger="input changed delay:300ms" hx-indicator="null" />

					<!-- Dropdown auto complete -->
					<div id="ticker-search-dropdown-list" class="dropdown-list" style="display: none;"></div>
				</div>

				<!-- Submit button -->
				<input type="submit" value="Search" />
			</form>
		</div>

		<progress id="search-progress" class="htmx-indicator"></progress>

		<!-- Tables -->
		<section id="tables">
			<div class="overflow-auto">
				<table class="striped">
					<thead id="share-table-head">
						<tr>
							<th scope="col">#</th>
							<th scope="col">Stock</th>
							<th scope="col">Allocation</th>
							<th scope="col">Ask price</th>
							<th scope="col">p/e ratio</th>
							<th scope="col">Net asset value</th>
							<th scope="col">Market cap</th>
							<th scope="col">Volume</th>
							<th scope="col">Dividend yield</th>
							<th scope="col"></th>
						</tr>
					</thead>
					{{ template "shareTable" .GetTrackedRowsData }}
				</table>
			</div>
		</section>
		<!-- ./ Tables -->

		<div id="popup_dialog"></div>

	</main>

</body>

<script>
	function deleteElement(elementId) {
		const element = document.getElementById(elementId);
		if (element) {
			element.remove();
		}
	}
</script>

</html>

{{ end }}

{{ block "shareTable" . }}
<tbody id="share-table-body" hx-ext="preload">
	{{ range . }}
	{{ template "shareTableRow" . }}
	{{ end }}
</tbody>
{{ end }}

{{ block "shareTableRow" . }}
<tr id="table-row-{{ .DisplaySymbol }}">
	<th scope="row"></th>
	<td><a href="#" hx-get="/sharesummary" hx-vals='{"ticker": "{{ .DisplaySymbol }}"}' hx-target="#popup_dialog"
			preload="mouseover" hx-on:click="event.preventDefault()">{{ .DisplaySymbol }}</a></td>
	<td><input type="text" name="input" min="0" max="100" aria-invalid="true"
			style="margin: 0; width: 120px; text-align: center;" /></td>
	<td>{{ .DisplayAsk }}</td>
	<td>{{ .DisplayPe }}</td>
	<td>{{ .DisplayNav }}</td>
	<td>{{ .DisplayMarketCap }}</td>
	<td>{{ .DisplayVolume }}</td>
	<td>{{ .DisplayDividendYield }}</td>
	<td>
		<button class="delete-row-button" aria-label="delete" hx-post="/deleteshare"
			hx-vals='{"ticker": "{{ .DisplaySymbol }}"}'>
			<svg class="row-trash-icon" viewBox="0 0 24 24">
				<path d="M3 6h18v2H3V6zm2 3h14v13H5V9zm5-5h4v2h-4V4zm-4 5v11h10V9H6z" />
			</svg>
		</button>
	</td>
</tr>
{{ end }}

{{ block "deleteShareTableRow" . }}
<tr id="table-row-{{ . }}" hx-swap-oob="delete"></tr>
{{ end }}

{{ block "autoCompleteDropdown" . }}
<!-- Dropdown auto complete -->
{{ range $index, $item := . }}
<div data-index="{{ $index }}"><span>{{ $item.Name }}</span> <sub>({{ $item.Description }})</sub></div>
{{ end }}
{{ end }}

{{ block "shareSummaryPopup" . }}
<dialog id="share-summary-popup-{{ . }}" class="summary-popup" open>
	<article>
		<h2>{{ . }}</h2>
		<p>
			Thank you for signing up for a membership!
			Please review the membership details below:
		</p>
		<ul>
			<li>Membership: Individual</li>
			<li>Price: $10</li>
		</ul>
		<footer>
			<button onclick="deleteElement('share-summary-popup-{{ . }}')">Confirm</button>
		</footer>
	</article>
</dialog>
{{ end }}
